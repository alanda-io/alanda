<p-table
  class="attachment-list"
  [value]="currentFiles"
  [scrollable]="true"
  scrollHeight="320px"
  autoLayout="true"
  dataKey="guid"
>
  <!-- 'let-columns' allows access to the ng-template context columns property-->
  <ng-template pTemplate="header">
    <tr>
      <th>Name</th>
      <th>Last Modified</th>
      <th>Size</th>
      <th>Action</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-file>
    <tr>
      <td>
        {{ file.name }}
      </td>
      <td>
        {{ file.lastModified | date: 'd MMMM y' }}
      </td>
      <td>{{ file.size }}&nbsp;KB</td>
      <td>
        <div class="action-button-wrapper">
          <button
            pButton
            pRipple
            type="button"
            (click)="triggerDownload(file.guid)"
            icon="pi pi-download"
            class="p-button-rounded p-button-text p-button-lg"
          ></button>
        </div>
        <div class="action-button-wrapper">
          <button
            pButton
            pRipple
            type="button"
            *ngIf="previewAllowed(file.name)"
            icon="pi pi-image"
            (click)="openFilePreview(file)"
            class="p-button-rounded p-button-text p-button-info p-button-lg"
          ></button>
        </div>
        <div class="action-button-wrapper">
          <button
            pButton
            pRipple
            type="button"
            (click)="onDeleteFile(file)"
            icon="pi pi-trash"
            class="p-button-rounded p-button-text p-button-danger p-button-lg"
          ></button>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>

<ng-container *ngIf="previewFile && showFilePreview">
  <p-dialog
    [(visible)]="showFilePreview"
    [resizable]="false"
    [header]="previewFile.name"
  >
    <div class="p-grid">
      <div class="p-col-12">
        <ng-template
          [ngIf]="!previewFile.name.endsWith('.pdf')"
          [ngIfElse]="pdfPreview"
        >
          <img
            [src]="downloadUrl(previewFile.guid)"
            [alt]="previewFile.name"
            [style]="{ width: 'auto', height: '60vh' }"
          />
        </ng-template>
        <ng-template #pdfPreview>
          <iframe
            [src]="
              sanitizer.bypassSecurityTrustResourceUrl(
                downloadUrl(previewFile.guid)
              )
            "
            [style]="{ width: '65vw', height: '78vh' }"
          ></iframe>
        </ng-template>
      </div>
    </div>
  </p-dialog>
</ng-container>
