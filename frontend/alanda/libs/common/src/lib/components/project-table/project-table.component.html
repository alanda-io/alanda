<div class="p-grid">
  <div class="p-col-3">
    <p-dropdown
      [hidden]="layouts.length <= 1"
      [options]="layouts"
      [(ngModel)]="selectedLayout"
      optionLabel="displayName"
      [style]="{ width: '100%' }"
      (onChange)="onChangeLayout()"
    >
    </p-dropdown>
  </div>
  <div class="p-col caption-button-group">
    <p-menu #menu [popup]="true" [model]="menuItems" appendTo="body"></p-menu>
    <button
      type="button"
      pButton
      icon="pi pi-bars"
      (click)="menu.toggle($event)"
    ></button>
  </div>
</div>
<p-table
  *ngIf="selectedLayout && projectsData"
  #tt
  [resizableColumns]="true"
  [value]="projectsData.results"
  [columns]="selectedLayout.columnDefs"
  [paginator]="true"
  [rows]="serverOptions.pageSize"
  [lazy]="true"
  [totalRecords]="projectsData.total"
  (onLazyLoad)="loadProjectsLazy($event)"
  [tableStyle]="{ 'table-layout': this.tableLayout }"
  [autoLayout]="true"
  [loading]="loading"
  [responsive]="true"
>
  <ng-template pTemplate="header" let-columns>
    <tr>
      <th
        *ngFor="let col of columns"
        pResizableColumn
        [pSortableColumn]="col.field"
        [style.width]="col.width + 'px'"
      >
        <span style="white-space: nowrap;"
          >{{ col.displayName }}<p-sortIcon></p-sortIcon
        ></span>
      </th>
    </tr>
    <tr>
      <th *ngFor="let col of columns">
        <p-calendar
          *ngIf="col.type && col.type === 'date'"
          (onSelect)="onDateSelect($event, col.field)"
          (onClearClick)="tt.filter('', col.field, 'equals')"
          [showButtonBar]="true"
          styleClass="p-column-filter"
          [readonlyInput]="true"
          [appendTo]="'body'"
          [dateFormat]="dateFormatPrime"
        >
        </p-calendar>
        <input
          *ngIf="!col || col.type !== 'date'"
          pInputText
          type="text"
          (input)="tt.filter($event.target.value, col.field, 'contains')"
          [value]="tt.filters[col.field] ? tt.filters[col.field].value : ''"
          style="width: 100%;"
        />
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-project let-columns="columns">
    <tr
      [pSelectableRow]="project"
      class="project-row"
      (dblclick)="openProject(project.project.projectId)"
    >
      <td
        *ngFor="let col of columns"
        [ngClass]="getCondition(project, col.template)"
        style="white-space: nowrap;"
      >
        <ng-template [ngIf]="col.name === 'Project ID'" [ngIfElse]="default">
          <a
            [routerLink]="getProjectPath(project.project.projectId)"
            [target]="target"
            >{{ project | nestedObject: col.field }}</a
          >
        </ng-template>
        <ng-template #default>
          <ng-container *ngIf="col.type && col.type === 'date'">{{
            project | nestedObject: col.field | date: dateFormat
          }}</ng-container>
          <ng-container *ngIf="!col || col.type !== 'date'">{{
            project | nestedObject: col.field
          }}</ng-container>
        </ng-template>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="paginatorleft"></ng-template>
  <ng-template pTemplate="paginatorright">
    <span *ngIf="editablePageSize" style="margin-right: 10px;">
      Rows per page:
      <alanda-page-size-select
        (valueChange)="changePageSize($event)"
        [maxPageSize]="projectsData.total"
      ></alanda-page-size-select>
    </span>
    <span *ngIf="projectsData.total">Total: {{ projectsData.total }}</span>
  </ng-template>
</p-table>
